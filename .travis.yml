language: node_js
node_js: "10.13.0"


matrix:
  include:
  # - name: "Linux"
  #   os: linux
  #   dist: xenial
  #   sudo: false
  # - name: "OSX"
  #   os: osx
  # - name: "Windows"
  #   os: windows
  - name: "OSX Build"
    os: osx
    env:
      - OSXBUILD=true
    # if: commit_message =~ /^:hammer:/
    language: cpp
    compiler: clang++
    cache:
      directories:
       - /Users/travis/qt-osx
    install:
      - if [[ ! -d /Users/travis/qt-osx/Qt ]]; then
          chmod +x ./install-qt.sh;
          chmod +x ./extract-qt-installer.sh;
          export QT_CI_PACKAGES=qt.qt5.5111.clang_64;
          ./install-qt.sh 5.11.1 /Users/travis/qt-osx;
        fi;
      - export PATH=/Users/travis/qt-osx/Qt/5.11.1/clang_64/bin:$PATH
    script:
      - qmake -spec macx-clang "QMAKE_CXXFLAGS+=-ObjC++" "INCLUDEPATH+=/Users/travis/qt-osx/Qt/5.11.1/clang_64/include" qt/_qmlui.pro
      - make
      - /Applications/Xcode-9.4.1.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/clang++ -v -stdlib=libc++ -Wl,-rpath,'' -headerpad_max_install_names -Wl,-syslibroot,/Applications/Xcode-9.4.1.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.13.sdk -mmacosx-version-min=10.11 -single_module -dynamiclib -compatibility_version 1.0 -current_version  1.0.0 -install_name libqmlui.dylib -o libqmlui.dylib qml-renderer.o qml-cb.o keyconv.o qml-view.o qml-ui.o qrc_qml.o moc_qml-renderer.o moc_qml-cb.o moc_qml-view.o  -F/Users/travis/qt-osx/Qt/5.11.1/clang_64/lib -framework QtQuick -framework QtQml -framework QtNetwork -framework QtCore -framework DiskArbitration -framework IOKit -framework QtGui -framework OpenGL -framework AGL  
      # - ls -la

install:
  - cd test
  - npm i

deploy:
  on:
    all_branches: true
    condition: $OSXBUILD = true
  provider: releases
  name: "Binary for OSX"
  body: $TRAVIS_COMMIT_MESSAGE
  api_key: $GITHUB_TOKEN
  skip_cleanup: true
  overwrite: true
  draft: true
  file:
    - bin-mac64/libqmlui.dylib
